<section class="content-wrapper">
  <div class="page-title border-bottom title-border">
    <div class="content">
      <div class="row">
        <div class="col-lg-12">
          <h5 class="text-gray d-inline">Business Management</h5>
          <h5 class="text-gray d-inline"> <i class="fa fa-angle-right"></i></h5>
          <h5 class="text-dark d-inline">View Business</h5>
        </div>
      </div>
    </div>
  </div>
  <div class="content position-relative">
    <div class='row mt-3 search-business'>
      <div class="col-sm-8 col-lg-4">
        <%# <input type="text" id="searchbox" class="form-control " style="width: 50%;display: inline;"> %>
        <div class="row">
          <div class="col-sm-6 col-lg-8">
            <div class="form-group has-search">
              <span class="fa fa-search form-control-feedback"></span>
              <input type="text" class="form-control" placeholder="Search Business" id="searchbox">
            </div>
          </div>
          <div class="col-sm-4 col-lg-4">
            <button class="btn btn-primary form-group search_btn">Search</button>
          </div>
        </div>
      </div>
      <div class="col-lg-8 col-sm-4">
        <div class="add-item-btn mb-3 d-sm-flex flex-wrap flex-row-reverse">
          <%= link_to "Add Business", new_business_path, remote: true, class: 'btn btn-primary mb-2' %>
        </div>
      </div>
    </div>
    <div class="admin-table bg-white table-responsive mt-3">
      <table class="table table-bordered w-100 mb-5" id="business_list_table">
        <thead class="thead-dark">
          <th>Business Name</th>
          <th>Address</th>
          <th>Domain</th>
          <th>State</th>
          <th>Venue</th>
          <th>Phone Number</th>
          <th>Action</th>
        </thead>
        <tbody>
    		<% @businesses.each do |business| %>
    			<tr>
    				<td><%= link_to business.name, business_path(business.id) %></td>
    				<td><%= business.address %></td>
            <td><%= link_to business.domain, url_simplifier(business.domain), target: "_blank" if business.domain %></td>
    				<td><%= business.state %></td>
            <% if business.venues.count == 0 %>
              <td><%= link_to business.venues.count, 'javascript:(0);' %></td>
            <% else %>
              <td><%= link_to business.venues.count, 'javascript:(0);', data: {toggle: 'modal', target: "#venueModal_#{business.id}"} %></td>
            <% end %>
            <td><%= business.phone_no %></td>
            <td>
              <div class="action-area-buttons">
                <%= link_to(edit_business_path(business), remote: true, class: 'fa') do %>
                  <%= image_pack_tag 'home/ic_edit.svg'%>
                <% end %>
                <%= link_to(business_path(business), method: :delete, class: 'fa', data: { confirm: 'Are you sure want to delete this Business?' }) do %>
                  <%= image_pack_tag 'home/ic_delete.svg'%>
                <% end %>
              </div>
            </td>
    			</tr>
    		<% end %>
        </tbody>
      </table>
      <% @businesses.each do |business| %>
        <%= render 'venue_modal', business: business %>
      <% end %>
    </div>
  </div>

</section>

<script>
  $(document).ready(function(){
    custom_datatable($('#business_list_table'));
    $('.modal-table').DataTable({
        "paging":   false,
        "info":     false});
  })
</script>
